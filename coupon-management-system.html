<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Coupon Management System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #333;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 30px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo {
        font-size: 24px;
        font-weight: bold;
        color: #667eea;
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .role-badge {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 12px;
        text-transform: uppercase;
        font-weight: 600;
      }

      .btn {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
        text-align: center;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .btn-secondary {
        background: linear-gradient(45deg, #f093fb, #f5576c);
      }

      .btn-success {
        background: linear-gradient(45deg, #4facfe, #00f2fe);
      }

      .card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 20px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #555;
      }

      .form-group input,
      .form-group textarea,
      .form-group select {
        width: 100%;
        padding: 12px;
        border: 2px solid #e1e8ed;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.3s ease;
      }

      .form-group input:focus,
      .form-group textarea:focus,
      .form-group select:focus {
        outline: none;
        border-color: #667eea;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 25px;
        border-radius: 15px;
        text-align: center;
      }

      .stat-number {
        font-size: 36px;
        font-weight: bold;
        margin-bottom: 8px;
      }

      .stat-label {
        font-size: 14px;
        opacity: 0.9;
      }

      .table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      .table th,
      .table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #e1e8ed;
      }

      .table th {
        background: #f8f9fa;
        font-weight: 600;
        color: #555;
      }

      .coupon-display {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 15px;
        text-align: center;
        margin: 20px 0;
      }

      .coupon-code {
        font-size: 32px;
        font-weight: bold;
        margin: 15px 0;
        letter-spacing: 3px;
        border: 2px dashed rgba(255, 255, 255, 0.5);
        padding: 20px;
        border-radius: 10px;
      }

      .coupon-value {
        font-size: 24px;
        margin-bottom: 20px;
      }

      .tab-container {
        margin-bottom: 20px;
      }

      .tabs {
        display: flex;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 5px;
        margin-bottom: 20px;
      }

      .tab {
        flex: 1;
        padding: 12px 20px;
        text-align: center;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
      }

      .tab.active {
        background: rgba(255, 255, 255, 0.9);
        color: #667eea;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .login-container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 20px;
      }

      .login-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
        max-width: 400px;
        width: 100%;
      }

      .login-title {
        text-align: center;
        font-size: 28px;
        font-weight: bold;
        color: #667eea;
        margin-bottom: 30px;
      }

      .hide {
        display: none !important;
      }

      .show {
        display: block !important;
      }

      .file-upload {
        border: 2px dashed #667eea;
        border-radius: 10px;
        padding: 30px;
        text-align: center;
        margin: 20px 0;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .file-upload:hover {
        background: rgba(102, 126, 234, 0.05);
      }

      .success-message {
        background: linear-gradient(45deg, #4facfe, #00f2fe);
        color: white;
        padding: 15px;
        border-radius: 8px;
        margin: 15px 0;
        text-align: center;
      }

      .error-message {
        background: linear-gradient(45deg, #f093fb, #f5576c);
        color: white;
        padding: 15px;
        border-radius: 8px;
        margin: 15px 0;
        text-align: center;
      }

      @media (max-width: 768px) {
        .header {
          flex-direction: column;
          gap: 15px;
        }

        .grid {
          grid-template-columns: 1fr;
        }

        .tabs {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
      <div class="login-card">
        <div class="login-title">Coupon Management System</div>
        <form id="loginForm">
          <div class="form-group">
            <label>Username</label>
            <input type="text" id="username" required />
          </div>
          <div class="form-group">
            <label>Password</label>
            <input type="password" id="password" required />
          </div>
          <button type="submit" class="btn" style="width: 100%">Login</button>
        </form>
        <div
          style="
            margin-top: 20px;
            padding: 15px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 8px;
            font-size: 14px;
          "
        >
          <strong>Demo Accounts:</strong><br />
          Employee: employee / emp123<br />
          Manager: manager / mgr123<br />
          Admin: admin / admin123
        </div>
      </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="hide">
      <div class="container">
        <!-- Header -->
        <div class="header">
          <div class="logo">Coupon Management System</div>
          <div class="user-info">
            <span id="currentUser"></span>
            <span id="userRole" class="role-badge"></span>
            <button class="btn" onclick="logout()">Logout</button>
          </div>
        </div>

        <!-- Dashboard Stats (Admin/Manager only) -->
        <div id="dashboardStats" class="stats-grid hide">
          <div class="stat-card">
            <div class="stat-number" id="totalCoupons">0</div>
            <div class="stat-label">Total Coupons</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="usedCoupons">0</div>
            <div class="stat-label">Used Coupons</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="availableCoupons">0</div>
            <div class="stat-label">Available Coupons</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="totalValue">$0</div>
            <div class="stat-label">Total Value</div>
          </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-container">
          <div class="tabs">
            <div class="tab active" onclick="showTab('request')">
              Request Coupon
            </div>
            <div id="manageTab" class="tab hide" onclick="showTab('manage')">
              Manage Coupons
            </div>
            <div id="historyTab" class="tab" onclick="showTab('history')">
              History
            </div>
          </div>
        </div>

        <!-- Request Coupon Tab -->
        <div id="requestTab" class="tab-content active">
          <div class="card">
            <h2 style="margin-bottom: 20px; color: #667eea">
              Request New Coupon
            </h2>
            <form id="couponRequestForm">
              <div class="grid">
                <div class="form-group">
                  <label>Customer Name</label>
                  <input type="text" id="customerName" required />
                </div>
                <div class="form-group">
                  <label>Customer Email</label>
                  <input type="email" id="customerEmail" required />
                </div>
              </div>
              <div class="form-group">
                <label>Situation/Reason</label>
                <textarea
                  id="situation"
                  rows="4"
                  placeholder="Describe the situation that requires issuing a coupon..."
                  required
                ></textarea>
              </div>
              <div class="grid">
                <div class="form-group">
                  <label>Issue Category</label>
                  <select id="issueCategory" required>
                    <option value="">Select Category</option>
                    <option value="product_defect">Product Defect</option>
                    <option value="shipping_delay">Shipping Delay</option>
                    <option value="customer_complaint">
                      Customer Complaint
                    </option>
                    <option value="service_issue">Service Issue</option>
                    <option value="promotional">Promotional</option>
                    <option value="other">Other</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Priority</label>
                  <select id="priority" required>
                    <option value="">Select Priority</option>
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                    <option value="urgent">Urgent</option>
                  </select>
                </div>
              </div>
              <button type="submit" class="btn btn-success" style="width: 100%">
                Generate Coupon
              </button>
            </form>

            <!-- Coupon Display -->
            <div id="couponDisplay" class="hide">
              <div class="coupon-display">
                <h3>Coupon Generated Successfully!</h3>
                <div class="coupon-code" id="generatedCode"></div>
                <div class="coupon-value" id="generatedValue"></div>
                <button
                  class="btn"
                  onclick="copyCoupon()"
                  style="background: rgba(255, 255, 255, 0.2)"
                >
                  Copy Coupon Code
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Manage Coupons Tab (Admin/Manager only) -->
        <div id="manageTab" class="tab-content">
          <div class="card">
            <h2 style="margin-bottom: 20px; color: #667eea">Manage Coupons</h2>

            <!-- Add Single Coupon -->
            <div style="margin-bottom: 30px">
              <h3 style="margin-bottom: 15px">Add Single Coupon</h3>
              <form id="addCouponForm">
                <div class="grid">
                  <div class="form-group">
                    <label>Coupon Code</label>
                    <input type="text" id="newCouponCode" required />
                  </div>
                  <div class="form-group">
                    <label>Price/Value</label>
                    <input
                      type="number"
                      id="newCouponPrice"
                      step="0.01"
                      required
                    />
                  </div>
                </div>
                <button type="submit" class="btn">Add Coupon</button>
              </form>
            </div>

            <!-- Bulk Upload -->
            <div style="margin-bottom: 30px">
              <h3 style="margin-bottom: 15px">Bulk Upload Coupons</h3>
              <div
                class="file-upload"
                onclick="document.getElementById('excelFile').click()"
              >
                <input
                  type="file"
                  id="excelFile"
                  accept=".xlsx,.xls,.csv"
                  style="display: none"
                  onchange="handleFileUpload(event)"
                />
                <div style="font-size: 48px; margin-bottom: 10px">📁</div>
                <div>Click to upload Excel/CSV file</div>
                <div style="font-size: 12px; margin-top: 5px; opacity: 0.7">
                  Expected columns: Code, Price
                </div>
              </div>
            </div>

            <!-- Available Coupons List -->
            <div>
              <h3 style="margin-bottom: 15px">Available Coupons</h3>
              <div style="max-height: 400px; overflow-y: auto">
                <table class="table">
                  <thead>
                    <tr>
                      <th>Code</th>
                      <th>Value</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="couponsTableBody"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- History Tab -->
        <div id="historyTab" class="tab-content">
          <div class="card">
            <h2 style="margin-bottom: 20px; color: #667eea">
              Coupon Request History
            </h2>
            <div style="max-height: 500px; overflow-y: auto">
              <table class="table">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Employee</th>
                    <th>Customer</th>
                    <th>Coupon Code</th>
                    <th>Value</th>
                    <th>Category</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody id="historyTableBody"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Application State
      let currentUser = null;
      let userRole = null;
      let coupons = [
        { code: 'SAVE10', price: 10, isUsed: false },
        { code: 'WELCOME20', price: 20, isUsed: false },
        { code: 'DISCOUNT15', price: 15, isUsed: false },
        { code: 'SPECIAL25', price: 25, isUsed: false },
        { code: 'BONUS30', price: 30, isUsed: false },
      ];
      let couponHistory = [];

      // Demo users with roles
      const users = {
        employee: {
          password: 'emp123',
          role: 'employee',
          name: 'John Employee',
        },
        manager: { password: 'mgr123', role: 'manager', name: 'Jane Manager' },
        admin: { password: 'admin123', role: 'admin', name: 'Admin User' },
      };

      // Initialize application
      document.addEventListener('DOMContentLoaded', function () {
        updateUI();
        updateCouponsTable();
        updateHistoryTable();
        updateStats();
      });

      // Login functionality
      document
        .getElementById('loginForm')
        .addEventListener('submit', function (e) {
          e.preventDefault();
          const username = document.getElementById('username').value;
          const password = document.getElementById('password').value;

          if (users[username] && users[username].password === password) {
            currentUser = users[username].name;
            userRole = users[username].role;

            document.getElementById('loginScreen').classList.add('hide');
            document.getElementById('mainApp').classList.remove('hide');

            document.getElementById('currentUser').textContent = currentUser;
            document.getElementById('userRole').textContent =
              userRole.toUpperCase();

            updateUI();
            updateStats();
          } else {
            alert('Invalid credentials!');
          }
        });

      // Update UI based on user role
      function updateUI() {
        if (userRole === 'admin' || userRole === 'manager') {
          document.getElementById('manageTab').classList.remove('hide');
          document.getElementById('dashboardStats').classList.remove('hide');
        } else {
          document.getElementById('manageTab').classList.add('hide');
          document.getElementById('dashboardStats').classList.add('hide');
        }
      }

      // Tab switching
      function showTab(tabName) {
        // Hide all tabs
        document.querySelectorAll('.tab-content').forEach((tab) => {
          tab.classList.remove('active');
        });
        document.querySelectorAll('.tab').forEach((tab) => {
          tab.classList.remove('active');
        });

        // Show selected tab
        document.getElementById(tabName + 'Tab').classList.add('active');
        event.target.classList.add('active');
      }

      // Coupon request form
      document
        .getElementById('couponRequestForm')
        .addEventListener('submit', function (e) {
          e.preventDefault();

          const availableCoupons = coupons.filter((c) => !c.isUsed);
          if (availableCoupons.length === 0) {
            alert(
              'No available coupons at the moment. Please contact your manager.',
            );
            return;
          }

          // Get random available coupon
          const randomCoupon =
            availableCoupons[
              Math.floor(Math.random() * availableCoupons.length)
            ];
          randomCoupon.isUsed = true;

          // Collect form data
          const requestData = {
            date: new Date().toLocaleDateString(),
            employee: currentUser,
            customerName: document.getElementById('customerName').value,
            customerEmail: document.getElementById('customerEmail').value,
            situation: document.getElementById('situation').value,
            category: document.getElementById('issueCategory').value,
            priority: document.getElementById('priority').value,
            couponCode: randomCoupon.code,
            couponValue: randomCoupon.price,
            status: 'Issued',
          };

          // Add to history
          couponHistory.unshift(requestData);

          // Display coupon
          document.getElementById('generatedCode').textContent =
            randomCoupon.code;
          document.getElementById('generatedValue').textContent =
            `$${randomCoupon.price} OFF`;
          document.getElementById('couponDisplay').classList.remove('hide');

          // Show success message
          showMessage('Coupon generated successfully!', 'success');

          // Update tables and stats
          updateCouponsTable();
          updateHistoryTable();
          updateStats();

          // Reset form
          this.reset();
        });

      // Add single coupon
      document
        .getElementById('addCouponForm')
        .addEventListener('submit', function (e) {
          e.preventDefault();

          const code = document.getElementById('newCouponCode').value;
          const price = parseFloat(
            document.getElementById('newCouponPrice').value,
          );

          // Check if coupon code already exists
          const existingCoupon = coupons.find(
            (c) => c.code.toLowerCase() === code.toLowerCase(),
          );
          if (existingCoupon) {
            showMessage('Coupon code already exists!', 'error');
            return;
          }

          coupons.push({
            code: code,
            price: price,
            isUsed: false,
          });

          updateCouponsTable();
          updateStats();
          showMessage('Coupon added successfully!', 'success');
          this.reset();
        });

      // Handle file upload for bulk coupons
      function handleFileUpload(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function (e) {
          try {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, { type: 'array' });
            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
            const jsonData = XLSX.utils.sheet_to_json(firstSheet);

            let addedCount = 0;
            let skippedCount = 0;

            jsonData.forEach((row) => {
              const code = row.Code || row.code;
              const price = parseFloat(row.Price || row.price);

              if (code && !isNaN(price)) {
                const existingCoupon = coupons.find(
                  (c) => c.code.toLowerCase() === code.toLowerCase(),
                );
                if (!existingCoupon) {
                  coupons.push({
                    code: code,
                    price: price,
                    isUsed: false,
                  });
                  addedCount++;
                } else {
                  skippedCount++;
                }
              }
            });

            updateCouponsTable();
            updateStats();
            showMessage(
              `Upload complete! Added: ${addedCount}, Skipped (duplicates): ${skippedCount}`,
              'success',
            );
          } catch (error) {
            showMessage(
              'Error reading file. Please check the format.',
              'error',
            );
          }
        };
        reader.readAsArrayBuffer(file);
      }

      // Copy coupon to clipboard
      function copyCoupon() {
        const couponCode = document.getElementById('generatedCode').textContent;
        navigator.clipboard.writeText(couponCode).then(() => {
          showMessage('Coupon code copied to clipboard!', 'success');
        });
      }

      // Delete coupon (admin/manager only)
      function deleteCoupon(index) {
        if (confirm('Are you sure you want to delete this coupon?')) {
          coupons.splice(index, 1);
          updateCouponsTable();
          updateStats();
          showMessage('Coupon deleted successfully!', 'success');
        }
      }

      // Update coupons table
      function updateCouponsTable() {
        const tbody = document.getElementById('couponsTableBody');
        if (!tbody) return;

        tbody.innerHTML = '';
        coupons.forEach((coupon, index) => {
          const row = tbody.insertRow();
          row.innerHTML = `
                    <td>${coupon.code}</td>
                    <td>$${coupon.price}</td>
                    <td>
                        <span style="padding: 4px 8px; border-radius: 4px; font-size: 12px; ${coupon.isUsed ? 'background: #f093fb; color: white;' : 'background: #4facfe; color: white;'}">
                            ${coupon.isUsed ? 'Used' : 'Available'}
                        </span>
                    </td>
                    <td>
                        ${userRole === 'admin' || userRole === 'manager' ? `<button class="btn" onclick="deleteCoupon(${index})" style="padding: 6px 12px; font-size: 12px;">Delete</button>` : '-'}
                    </td>
                `;
        });
      }

      // Update history table
      function updateHistoryTable() {
        const tbody = document.getElementById('historyTableBody');
        if (!tbody) return;

        tbody.innerHTML = '';

        // Show all history for admin/manager, only own requests for employees
        const filteredHistory =
          userRole === 'admin' || userRole === 'manager'
            ? couponHistory
            : couponHistory.filter((h) => h.employee === currentUser);

        filteredHistory.forEach((record) => {
          const row = tbody.insertRow();
          row.innerHTML = `
                    <td>${record.date}</td>
                    <td>${record.employee}</td>
                    <td>${record.customerName}</td>
                    <td>${record.couponCode}</td>
                    <td>$${record.couponValue}</td>
                    <td>${record.category.replace('_', ' ').toUpperCase()}</td>
                    <td>
                        <span style="padding: 4px 8px; border-radius: 4px; font-size: 12px; background: #4facfe; color: white;">
                            ${record.status}
                        </span>
                    </td>
                `;
        });
      }

      // Update dashboard statistics
      function updateStats() {
        if (userRole !== 'admin' && userRole !== 'manager') return;

        const totalCoupons = coupons.length;
        const usedCoupons = coupons.filter((c) => c.isUsed).length;
        const availableCoupons = totalCoupons - usedCoupons;
        const totalValue = coupons.reduce((sum, c) => sum + c.price, 0);

        document.getElementById('totalCoupons').textContent = totalCoupons;
        document.getElementById('usedCoupons').textContent = usedCoupons;
        document.getElementById('availableCoupons').textContent =
          availableCoupons;
        document.getElementById('totalValue').textContent = `$${totalValue}`;
      }

      // Show message
      function showMessage(message, type) {
        const messageDiv = document.createElement('div');
        messageDiv.className =
          type === 'success' ? 'success-message' : 'error-message';
        messageDiv.textContent = message;

        document
          .querySelector('.container')
          .insertBefore(
            messageDiv,
            document.querySelector('.container').firstChild,
          );

        setTimeout(() => {
          messageDiv.remove();
        }, 3000);
      }

      // Logout
      function logout() {
        currentUser = null;
        userRole = null;
        document.getElementById('loginScreen').classList.remove('hide');
        document.getElementById('mainApp').classList.add('hide');
        document.getElementById('loginForm').reset();
      }
    </script>
  </body>
</html>
